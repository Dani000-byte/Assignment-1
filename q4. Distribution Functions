â€¢	NTILE(4) - Customer quartiles
SELECT 
    c.customer_id,
    c.name,
    COUNT(t.transaction_id) AS total_purchases,
    SUM(t.total_amount) AS total_spent,
    NTILE(4) OVER (ORDER BY SUM(t.total_amount) DESC) AS quartile_segment
FROM customers c
JOIN transactions t ON c.customer_id = t.customer_id
GROUP BY c.customer_id, c.name
ORDER BY quartile_segment, total_spent DESC;
